# Injection 방어기법

[SQL Injection 방어기법]

1. 정적쿼리를 사용한다. = 구조화된 쿼리 실행 = 파라미터화된 쿼리 실행 = PreparedStatement 객체를 이용
2. 동적쿼리를 사용해야 하는 경우, 입력값에 반드시 쿼리 조작 문자열 포함 여부를 확인 후 사용한다.
3. 오류 메시지에 시스템 정보가 포함되지 않도록 통제한다. ⇒ Error-Based SQL Injection 공격을 완화
4. 어플리케이션에서 사용하는 DB 사용자 계정에 대해 최소 권한을 부여한다. = 해당 어플리케이션에서 사용하는 DB 객체에 대해서만 사용 권한을 부여한다. ⇒ SP 또는 UNION-Based SQL Injection 공격을 완화

5. ORM을 이용해서 개발하는 경우, 외부 입력값을 쿼리맵에 바이딩할 때는 반드시 # 기호를 이용한다.

select * from users where userid = #pUserId# and password = $pPassword$

pUserId : 123
pPassword : 789
⇒ select * from users where userid = ? and password = 789

$ : 입력값이 그대로 문자열 결합하는 형태로 처리

#: 입력값을 PreparedStatement에 변수처럼 처리



[Command Injection 방어기법]

1. 운영체제 명령어 실행을 통한 서비스 제공의 필요성을 검토 → 불필요한 운영체제 명령어 실행을 제거하거나 또는 다른 기능으로 대체한다.
2. 해당 시스템에서 사용할 명령어를 미리 정의하고, 정의된 범위 내에서만 사용될 수 있도록 제한한다. = 화이트 리스트(허용 목록) 방식으로 입력값을 제한
3. 추가 명령어 실행에 사용되는 &, |, ; 과 같은 문자가 입력값에 포함되어 있는 검증한다.

**입력값 검증 제한 방식**
**화이트 리스트 : 허용 목록**
  블랙 리스트 : 제한 목록

입력값 유형 a, b, c가 존재하는 경우, 
검증 결과 a는 안전하고, b, c는 안전하지 않을 경우, 
허용 목록에 a를, 제한 목록에 b, c를 등록
허용 목록이나 제한 목록이나 a, b, c가 입력되었을 때 a만 사용하게 된다.

아직 검증되지 않은 새로운 유형 x, y, z이 입력되었을 때, 
허용 목록을 적용하면 여전히 a만 사용하게 되나, 
제한 목록을 적용하면 a 뿐만 아니라, x, y, z도 사용하게 된다.

만약에 x, y, z가 안전하지 않은 유형이라면, 
허용 목록을 적용하면 동일한 보안성이 보증되는 것이나, 
제한 목록을 적용하면 시스템이 취약해 질 수 있다.